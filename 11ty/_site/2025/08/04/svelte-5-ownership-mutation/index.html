<!doctype html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="description" content="The intersection of development and design." />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <title>Svelte 5 Ownership Mutation</title>

  <link rel="icon" type="image/x-icon" href="/img/edit.svg">  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="alternate" type="application/rss+xml" title="Kevin Hoyt" href="/feed.xml" />  

  <link rel="stylesheet" href="/style/kevinhoyt.css" />
  <link rel="stylesheet" href="/style/header.css" />
  <link rel="stylesheet" href="/style/post.css" />
  <link rel="stylesheet" href="/style/prism.css" />    
  <link rel="stylesheet" href="/style/footer.css" />

</head>
<body>
  
  <header id="header" >
  <article>
    <img class="logo" src="/img/krhoyt.jpg">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/blog">Blog</a></li>    
      <li><a href="/about">About</a></li>
      <li><a href="/events">Events</a></li>
    </ul>  
    <div>
      <a href="https://bsky.app/profile/krhoyt.bsky.social" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" d="M12 11.388c-.906-1.761-3.372-5.044-5.665-6.662c-2.197-1.55-3.034-1.283-3.583-1.033C2.116 3.978 2 4.955 2 5.528c0 .575.315 4.709.52 5.4c.68 2.28 3.094 3.05 5.32 2.803c-3.26.483-6.157 1.67-2.36 5.898c4.178 4.325 5.726-.927 6.52-3.59c.794 2.663 1.708 7.726 6.444 3.59c3.556-3.59.977-5.415-2.283-5.898c2.225.247 4.64-.523 5.319-2.803c.205-.69.52-4.825.52-5.399c0-.575-.116-1.55-.752-1.838c-.549-.248-1.386-.517-3.583 1.033c-2.293 1.621-4.76 4.904-5.665 6.664"/>
        </svg>
      </a>
      <a href="https://github.com/krhoyt" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/>
        </svg>
      </a>      
      <a href="https://www.youtube.com/channel/UCSFeFhtLBuzU2UMs7oOL54A" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" d="m10 15l5.19-3L10 9zm11.56-7.83c.13.47.22 1.1.28 1.9c.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83c-.25.9-.83 1.48-1.73 1.73c-.47.13-1.33.22-2.65.28c-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44c-.9-.25-1.48-.83-1.73-1.73c-.13-.47-.22-1.1-.28-1.9c-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83c.25-.9.83-1.48 1.73-1.73c.47-.13 1.33-.22 2.65-.28c1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44c.9.25 1.48.83 1.73 1.73"/>
        </svg>
      </a>          
      <a href="https://www.instagram.com/parkerkrhoyt" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 14 14">
          <path fill="currentColor" fill-rule="evenodd" d="M3.39.787A2.604 2.604 0 0 0 .786 3.39v6.944a2.604 2.604 0 0 0 2.604 2.604h6.944a2.604 2.604 0 0 0 2.603-2.604V3.39A2.604 2.604 0 0 0 10.334.787zm7.693 2.607a.75.75 0 1 1-1.5 0a.75.75 0 0 1 1.5 0m-4.22 1.388a2.08 2.08 0 1 0 0 4.16a2.08 2.08 0 0 0 0-4.16m-3.081 2.08a3.08 3.08 0 1 1 6.16 0a3.08 3.08 0 0 1-6.16 0" clip-rule="evenodd"/>
        </svg>
      </a>     
    </div>
  </article>
</header>


  
  <main>

    <div>
      <img src="/img/covers/data.binding.jpg" alt="Svelte 5 Ownership Mutation">

      
        <figcaption>
          <p>Photo by <a href="https://unsplash.com/@rzunikoff">Robert Zunikoff</a> on <a href="https://unsplash.com/photos/closeup-photo-of-brown-rope--yz22gsqAH0">Unsplash</a></p>
        </figcaption>
      
    </div>

    <article>
      <h1>Svelte 5 Ownership Mutation</h1>
      <time>Aug 4, 2025 &bull; 11 min read</time>
      <p>One of my favorite aspects of <a href="https://svelte.dev/">Svelte</a> is that it adds robust data binding to the Web, and then gets out of the way. Do not get me wrong, data binding with <a href="https://github.com/tc39/proposal-observable">Observable</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a> added to the standard is great. I know that is what Svelte is using under the hood - which makes me happy - but the syntactic sugar afforded by the Svelte compiler is pure joy. Until it is not.</p>
<p>One of my applications, <a href="https://flavorawesome.com/">Flavor Awesome</a>, depends heavily on data binding to unknown form elements created at runtime by external metadata. This configuration creates a complex data binding scenario from which I have learned a lot. In this post I will dive deep into some of the more obscure data binding scenarios that I either missed, or that are not covered well, in the Svelte documentation.</p>
<h2>The Counter Component</h2>
<p>When describing data binding (the <code>$state</code> rune) in a component, the Svelte documentation presents a counter value that is a <code>Number</code>. When you click an increment button, the counter is incremented by one. The inverse is true for decrementing the count. Svelte then updates the display of the counter in the HTML as it detects the change. It goes something like thisâ€¦</p>
<pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span>
  <span class="token keyword">import</span> decrease <span class="token keyword">from</span> <span class="token string">"$lib/assets/arrow-down.svg"</span><span class="token punctuation">;</span>  
  <span class="token keyword">import</span> increase <span class="token keyword">from</span> <span class="token string">"$lib/assets/arrow-up.svg"</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">onDecreaseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> count <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      count <span class="token operator">=</span> count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">onIncreaseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

<span class="token operator">&lt;</span>article<span class="token operator">></span>
  <span class="token operator">&lt;</span>button 
    aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">"Decrease"</span> 
    disabled<span class="token operator">=</span><span class="token punctuation">{</span>count <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span> 
    onclick<span class="token operator">=</span><span class="token punctuation">{</span>onDecreaseClick<span class="token punctuation">}</span> 
    type<span class="token operator">=</span><span class="token string">"button"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>img alt<span class="token operator">=</span><span class="token string">"Arrow pointing down"</span> src<span class="token operator">=</span><span class="token punctuation">{</span>decrease<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
  <span class="token operator">&lt;</span>button 
    aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">"Increase"</span> 
    onclick<span class="token operator">=</span><span class="token punctuation">{</span>onIncreaseClick<span class="token punctuation">}</span> 
    type<span class="token operator">=</span><span class="token string">"button"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>img alt<span class="token operator">=</span><span class="token string">"Arrow pointing up"</span> src<span class="token operator">=</span><span class="token punctuation">{</span>increase<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>article<span class="token operator">></span></code></pre>
<p>Great! Wow! Data binding with Svelte is magical and easy to use. If you want to seed the counter value from outside of the component, you remove the <code>$state</code> rune, and replace it with a property value (<code>$props</code>). This is defined as such...</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> <span class="token punctuation">{</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">$props</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>When you change the counter value inside the component, that change happens only inside the component itself. If you want the change to bubble up, then you need to add an event listener to the component. When the counter is changed inside the component, you make the change, and then call the event listener, passing the new counter value as an argument.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> <span class="token punctuation">{</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> onchange<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">$props</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onDecreaseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> count <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count <span class="token operator">=</span> count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> onchange <span class="token punctuation">)</span> <span class="token function">onchange</span><span class="token punctuation">(</span> count <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onIncreaseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> onchange <span class="token punctuation">)</span> <span class="token function">onchange</span><span class="token punctuation">(</span> count <span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>  </code></pre>
<p>If you are binding the counter value to the component, then you do not even need to make the change to the counter in the component itself. When the change is made to the counter value outside of the component, it will be updated inside the component as well. Data binding magic once more.</p>
<h2>The Counter As A Property</h2>
<p>I have been brief in this review of Svelte data binding because it is covered well in the documentation. If you need more detail, I would suggest heading over to the <a href="https://svelte.dev/playground/component-bindings">documentation</a> to brush up before continuing with this post. Here is the catch: What happens when the counter is not a <code>Number</code> value, but rather a <code>Number</code> property on a custom <code>Object</code>? This is where things get interesting.</p>
<p>You might be inclined to perform the same operations, but on the relevant property. Something like...</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// This will cause an error</span>
item<span class="token punctuation">.</span>count <span class="token operator">=</span> item<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></code></pre>
<p>When you do this, you will get an error from Svelte. The error is displayed as <code>ownership_invalid_mutation</code>. A description of the problem is provided with the error, and you can go down a rabbit hole trying to understand it. I did.</p>
<p>First, you have to think of <code>$state</code> and <code>$props</code> as different things. The <code>$state</code> rune will monitor property changes. A component property (<code>$props</code>) is a snapshot of the value being passed into the component.</p>
<p>Second, when you make a change to the value of a component property, and that value is a primitive such as <code>Number</code>, then you will not get the error. When the value being passed to the component is an <code>Object</code> however, and then you change a property of that <code>Object</code>, Svelte is telling you that the component does not own the original <code>Object</code>. More specifically, it is saying that the property changes on the <code>Object</code> will not be applied because unlike <code>$state</code>, the component property is a snapshot, not a state value.</p>
<h2>Updating the Property</h2>
<p>You have two choices in this scenario. This first is to use the event listener to bubble up the changed value. That change then gets applied at the level where it is owned (<code>$state</code>), and the subsequent data bindings are updated in turn.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token function">$state</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onDecreaseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  count <span class="token operator">=</span> count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> onchange <span class="token punctuation">)</span> <span class="token function">onchange</span><span class="token punctuation">(</span> count <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Depending on the complexity of your components, this works great. If your components are heavily nested, then you may have to bubble up the change repeatedly until the change gets to a place where the owner (<code>$state</code>) can be modified.</p>
<p>In the case of Flavor Awesome, the form fields are components, and they live inside a form component. That form component tracks changes on the source <code>Object</code>, but that <code>Object</code> is itself a component property. Because I am using metadata to define the form, the <code>Object</code> properties may be different. The form component is also responsible for validation before bubbling up the modified <code>Object</code> when the changes are committed. Using the bubbling approach then creates an event listener mess.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">onDecreaseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> item <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span> item<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> item<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    item <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span> item<span class="token punctuation">,</span> count<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> onchange <span class="token punctuation">)</span> <span class="token function">onchange</span><span class="token punctuation">(</span> item <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The second option is to modify the property of the <code>Object</code> at the form level, and then have the changes updated through data binding. When the form is filled out, and validated, the modified <code>Object</code> is then bubbled. As we have just seen however, modifying an <code>Object</code> property will result in an error because the form component does not own the original <code>Object</code>.</p>
<p>The trick here is to replace the <code>Object</code> property <strong>in its entirety</strong> at the form level through Object destructuring. This will trigger data binding at the form level, and update the form field component appropriately. We are effectively working on the snapshot of the <code>Object</code> until it is ready to be bubbled.</p>
<h2>On Snapshots</h2>
<p>When the bubbled changes reach the owner, and you have made changes to the original <code>Object</code>, you may want to use <code>console.log()</code> to verify the contents before you write the code to commit the changes. If you use <code>console.log()</code> on the owning object you will get a different Svelte error that reads <code>console_log_state</code>. This error is presented because you are logging the <code>Proxy</code> object that holds the <code>$state</code> value.</p>
<pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> $state<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span> item <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Thankfully, the <code>$state</code> rune has a <code>snapshot()</code> method you can use to get a copy of the <code>Object</code> itself at that point in time.</p>
<p>The <code>$state.snapshot()</code> method is useful in other scenarios as well. Flavor Awesome uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a> to manage data locally in the browser. You can put a <code>$state</code> value into IndexedDB collection, but what you will be storing is the <code>Proxy</code> object, not the value of the <code>Object</code> that <code>Proxy</code> is watching. What we want is the actual <code>Object</code> value. Here, you can use the <code>$state.snapshot()</code> method to get that original <code>Object</code> before you insert it into the database.</p>
<h2>Next Steps</h2>
<p>Data binding with Svelte is very powerful. As Uncle Ben says though &quot;With great power comes great responsibility.&quot; Understanding the data on which you are operating becomes a very important aspect of developing with Svelte. Hopefully this post has shed some light on the deeper nuances of that process - especially as it relates to components. If you want to play with the concepts further, the code for this post is available as a <a href="https://gist.github.com/krhoyt/609e2f6b950355e9b051dc1904534cbb">GitHub Gist</a>.</p>

      <time>Published on Aug 4, 2025</time>
    </article>
  </main>
          

  <footer id="footer">
  <p>
    <a href="https://kevinhoyt.com">Kevin Hoyt</a>
    &copy; 2025 - Published with
    <a href="https://www.11ty.dev">Eleventy</a>
  </p>
</footer>


</body>
</html>
