<!doctype html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="description" content="The intersection of development and design." />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <title>Real-Time Engine Telemetry</title>

  <link rel="icon" type="image/x-icon" href="/img/edit.svg">  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="alternate" type="application/rss+xml" title="Kevin Hoyt" href="/feed.xml" />  

  <link rel="stylesheet" href="/style/kevinhoyt.css" />
  <link rel="stylesheet" href="/style/header.css" />
  <link rel="stylesheet" href="/style/contact.css" />    
  <link rel="stylesheet" href="/style/post.css" />
  <link rel="stylesheet" href="/style/prism.css" />    
  <link rel="stylesheet" href="/style/footer.css" />

</head>
<body>
  
  <header id="header">

  <article>

    <kh-follow>
      <img alt="Kevin Hoyt" src="/img/krhoyt.jpg">
    </kh-follow>

    <nav>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path fill="currentColor" d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z"/>
      </svg>         
      <select aria-label="Section">
        <option value="/" >Home</option>
        <option value="/blog" >Writing</option>
        <option value="/about" >About</option>
        <option value="/events" >Events</option>
      </select>      
    </nav>

    <ul>
      <li><a aria-label="Home" href="/">Home</a></li>
      <li><a aria-label="Writing (Blog)" href="/blog">Writing</a></li>    
      <li><a aria-label="About" href="/about">About</a></li>
      <li><a aria-label="Events" href="/events">Events</a></li>
    </ul>  

    <div>

      <!-- LinkedIn -->
      <a aria-label="LinkedIn" href="https://www.linkedin.com/in/parkerkrhoyt" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93zM6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37z"/>
        </svg>
      </a>      

      <!-- GitHub -->
      <a aria-label="GitHub" href="https://github.com/krhoyt" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/>
        </svg>
      </a>      

      <!-- X -->
      <a aria-label="Twitter" href="https://x.com/krhoyt" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" fill-rule="evenodd" d="M5 1a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h14a4 4 0 0 0 4-4V5a4 4 0 0 0-4-4zm-.334 3.5a.75.75 0 0 0-.338 1.154l5.614 7.45l-5.915 6.345l-.044.051H6.03l4.83-5.179l3.712 4.928a.75.75 0 0 0 .337.251h4.422a.75.75 0 0 0 .336-1.154l-5.614-7.45L20.017 4.5h-2.05l-4.83 5.18l-3.714-4.928a.75.75 0 0 0-.337-.252zm10.88 13.548L6.431 5.952H8.45l9.114 12.095z" clip-rule="evenodd"/>
        </svg>
      </a>

      <!-- Bluesky (not listed)
      <a aria-label="Bluesky" href="https://bsky.app/profile/krhoyt.bsky.social" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" d="M12 11.388c-.906-1.761-3.372-5.044-5.665-6.662c-2.197-1.55-3.034-1.283-3.583-1.033C2.116 3.978 2 4.955 2 5.528c0 .575.315 4.709.52 5.4c.68 2.28 3.094 3.05 5.32 2.803c-3.26.483-6.157 1.67-2.36 5.898c4.178 4.325 5.726-.927 6.52-3.59c.794 2.663 1.708 7.726 6.444 3.59c3.556-3.59.977-5.415-2.283-5.898c2.225.247 4.64-.523 5.319-2.803c.205-.69.52-4.825.52-5.399c0-.575-.116-1.55-.752-1.838c-.549-.248-1.386-.517-3.583 1.033c-2.293 1.621-4.76 4.904-5.665 6.664"/>
        </svg>
      </a>
      -->      

      <!-- YouTube (not listed)
      <a aria-label="YouTube" href="https://www.youtube.com/channel/UCSFeFhtLBuzU2UMs7oOL54A" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" d="m10 15l5.19-3L10 9zm11.56-7.83c.13.47.22 1.1.28 1.9c.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83c-.25.9-.83 1.48-1.73 1.73c-.47.13-1.33.22-2.65.28c-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44c-.9-.25-1.48-.83-1.73-1.73c-.13-.47-.22-1.1-.28-1.9c-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83c.25-.9.83-1.48 1.73-1.73c.47-.13 1.33-.22 2.65-.28c1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44c.9.25 1.48.83 1.73 1.73"/>
        </svg>
      </a>          
      -->

      <!-- RSS feed -->
      <a aria-label="RSS Feed (XML)" href="/feed.xml" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19t.588-1.412T5 17t1.413.588T7 19t-.587 1.413T5 21m13.5 0q-.65 0-1.088-.475T16.9 19.4q-.275-2.425-1.312-4.537T12.9 11.1T9.138 8.413T4.6 7.1q-.65-.075-1.125-.512T3 5.5t.45-1.062t1.075-.363q3.075.275 5.763 1.563t4.737 3.337t3.338 4.738t1.562 5.762q.05.625-.363 1.075T18.5 21m-6 0q-.625 0-1.075-.437T10.85 19.5q-.225-1.225-.787-2.262T8.65 15.35t-1.888-1.412T4.5 13.15q-.625-.125-1.062-.575T3 11.5q0-.65.45-1.075t1.075-.325q1.825.25 3.413 1.063t2.837 2.062t2.063 2.838t1.062 3.412q.1.625-.325 1.075T12.5 21"/>
        </svg>
      </a>      

      <!-- Instagram (not listed)
      <a aria-label="Instagram" href="https://www.instagram.com/parkerkrhoyt" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 14 14">
          <path fill="currentColor" fill-rule="evenodd" d="M3.39.787A2.604 2.604 0 0 0 .786 3.39v6.944a2.604 2.604 0 0 0 2.604 2.604h6.944a2.604 2.604 0 0 0 2.603-2.604V3.39A2.604 2.604 0 0 0 10.334.787zm7.693 2.607a.75.75 0 1 1-1.5 0a.75.75 0 0 1 1.5 0m-4.22 1.388a2.08 2.08 0 1 0 0 4.16a2.08 2.08 0 0 0 0-4.16m-3.081 2.08a3.08 3.08 0 1 1 6.16 0a3.08 3.08 0 0 1-6.16 0" clip-rule="evenodd"/>
        </svg>
      </a>
      -->     

    </div>

  </article>

</header>


  
  
    <main>

      <div>

        <img src="/img/covers/engine.jpg" alt="Real-Time Engine Telemetry">

        
          <figcaption>
            <p>Photo by <a href="https://unsplash.com/@cakirchoff">Chad Kirchoff</a> on <a href="https://unsplash.com/photos/gray-and-black-engine-xe-e69j6-Ds">Unsplash</a></p>
          </figcaption>
        

      </div>

      <article>

        <h1>Real-Time Engine Telemetry</h1>

        <time>May 14, 2015 · 6 min read</time>

        
          <aside>
            
              <p>IoT</p>
            
              <p>Web</p>
            
          </aside>
                
        
        <p><em><a href="https://www.automatic.com/">Automatic</a> is a great product passes data from your cars computer to your phone, and onto the servers for analysis.  Insurance companies like <a href="https://www.progressive.com/auto/snapshot/">Progressive</a> and <a href="https://www.esurance.com/drivesense">eSurance</a> have also picked up on this to offer their customers discounts for responsible driving.  The same technology has been used extensively in transportation and logistics by companies such as <a href="http://tv.adobe.com/watch/adobe-summit-2014/adobe-summit-2014-day-two-keynote-chapter-two/">FedEx</a>.</em></p>
<p>This is reposted on the <a href="http://kaazing.org/blog/real-time-vehicle-telemetry/">Kaazing Open Source Blog</a>.</p>
<div id="VephhH4buCI" class="eleventy-plugin-youtube-embed" style="position:relative;width:100%;padding-top: 56.25%;"><iframe style="position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;" width="100%" height="100%" frameborder="0" title="Embedded YouTube video" src="https://www.youtube-nocookie.com/embed/VephhH4buCI" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div>
<p>On the insurance and smart driving fronts, these products tend to operate in a batch mode.  They give helpful analytics over the long-term, but are not particularly designed for real-time.  Real-time offerings exist for transportation and logistics, but these systems can be very costly.  With the advances in microcomputing, IoT (Internet of Things), and real-time connectivity, you can now deliver the same experiences on the cheap using off the shelf hardware.</p>
<h3>On-Board Diagnostics System</h3>
<p>Pretty much every vehicle manufactured since 1995 has an on-board computer.  These computers offer a number of services to the vehicle itself, but can also be tapped into by third parties through a protocol referred to as OBD (on-board diagnostics).  If you take your car into the shop, they will likely use this interface to take a peek under the hood, without having to manually check every system.</p>
<p><img src="/img/assets/nissan.altima.obd.jpg" alt="An OBD port in a 2005 Nissan Altima"></p>
<p>The OBD port is generally located under the driver-side dashboard.  It is a fairly blocky looking thing, that is more narrow on one side than the other.  As it turns out, there are a variety of adapters made to plug into these ports.  The one we chose to use was an ELM-327 unit that communicated via Bluetooth.  These units also come in wi-fi and USB flavors.</p>
<p><img src="/img/assets/elm327.bluetooth.mini.jpg" alt="ELM327 Bluetooth Mini"></p>
<h3>OBD Protocol</h3>
<p>Technically the OBD protocol is an <a href="http://en.wikipedia.org/wiki/ISO_15765-4">ISO standard</a> but there are many other variations.  You effectively open the serial port to your OBD connector, and then issue a series of commands.  Many of these commands have been well <a href="https://en.wikipedia.org/wiki/OBD-II_PIDs">documented</a> by the community, and you can find libraries for languages such as <a href="https://github.com/pires/obd-java-api">Java</a> and <a href="https://github.com/EricSmekens/node-bluetooth-obd">Node.js</a>.  A typical exchange looks something like the following snippet.</p>
<pre class="language-text"><code class="language-text">atz                   // OBD protocol
> ELM327 v1.3a
    
atrv                  // Vehicle voltage
> 12.5V
    
atsp0                 // Protocol level
> OK
    
0100                  // Current data
> 41 00 BF 9F A8 93  
    
010c                  // Engine RPM
> 41 0C 0E 96</code></pre>
<p>As <a href="http://kaazing.com">Kaazing Gateway</a> provides a Java client, this was our stack for this project.  The Java OBD library expects an InputStream and OutputStream to work.  Serial Java communications is not yet standardized, but we like the <a href="https://github.com/scream3r/java-simple-serial-connector/releases">jSSC</a> (Java Simple Serial Connector) project.  The problem with jSSC is that it does not expose InputStream or OutputStream projects, but rather works off an event-based approach.  In the end, we rolled our own lightweight, hardly complete, OBD protocol implementation on top of jSSC.</p>
<blockquote>
<p>You can find all the code for this project, including our jSSC-based implementation of OBD in my <a href="https://github.com/krhoyt/Kaazing">Kaazing GitHub repository</a> under &quot;iot/cars/java&quot;.</p>
</blockquote>
<h3>Geolocation</h3>
<p>Most ECUs (engine control units) have access to on-board GPS systems, but these are generally exposed under vendor-specific OBD commands that are not well documented (if at all).  To address this, we used a third-party <a href="http://www.amazon.com/gp/product/B000PKX2KA/ref=oh_aui_detailpage_o04_s00?ie=UTF8&amp;psc=1">USB GPS module</a>.  GPS units talk using <a href="http://www.gpsinformation.org/dale/nmea.htm">NMEA</a> (National Marine Electronics Association) data, which is also well documented.  It is effectively a string of comma-separated values.</p>
<pre class="language-text"><code class="language-text">$GPGGA,123519,4807.038,N,01131.000,E,1,08,0.9,545.4,M,46.9,M,,*47</code></pre>
<p>Which means:</p>
<ul>
<li>Fix taken at 12:35:19 UTC</li>
<li>Latitude 48 deg 07.038' N</li>
<li>Longitude 11 deg 31.000' E</li>
<li>Fix quality: 1 = GPS fix</li>
<li>8 satellites being tracked</li>
<li>0.9 horizontal dilution of position</li>
<li>545.4,M altitude in meters above mean sea level</li>
<li>46.9,M height of mean sea level</li>
<li>(empty field) time in seconds since last update</li>
<li>(empty field) station ID number</li>
<li>*47 checksum data</li>
</ul>
<p>I was initially worried that jSSC would only allow access to a single USB port at a time, but it turns out that it can support multiple ports at once.  Our Java program then pulls OBD data and GPS data, and merges the information.  The merged information is stored locally for playback or batch processing, but also published through Kaazing Gateway using <a href="https://www.amqp.org/">AMQP</a> (Advanced Message Queing Protocol).</p>
<p>Because we are using a publish-subscribe architecture, any number of systems could be listening for this telemetry data.  This might be an insurance company, the vehicle manufacturer, government highway safety, etc.  This decoupling of data from client is a big step forward over traditional request-response approaches.  For our project, we simply received the information in a web browser.</p>
<h3>Web Client</h3>
<p>Kaazing Gateway also provides a JavaScript client for AMQP using WebSocket (pioneered at Kaazing).  This allows us to listen for vehicle data in real-time on the Web.  A splash of Google Maps shows where the vehicle is geographically located.  SVG (Scalable Vector Graphics) in turn, provide for crisp rendering of the engine data itself.  We went with the basic information provided on most vehicle dashboards - fuel level, speed, RPM, and engine coolant temperature.</p>
<p>The result is real-time vehicle telemetry across devices and clients - and at a total cost of about $100 USD.  In this case we used a MacBook Pro as our computer, which was then in turn wirelessly connected to a mobile hotspot from a smartphone.  A Raspberry Pi would be equally effective for this purpose, and provide a much small footprint.  If you are looking for something more industrial in nature, Intel makes an <a href="http://www.intel.com/content/www/us/en/internet-of-things/gateway-solutions.html">IoT Gateway</a> product, which includes a GSM radio.</p>
<h3>Next Steps</h3>
<p>With modern web standards, there is no reason that your IoT data should be delivered in a batch approach.  Most developers look to batch processing with request-response because that is what is most comfortable to them.  The information loss however, especially in industrial applications, can be significant.  Finding out that a refrigerated freight vehicle has blown it's compressor could mean valuable loss of cargo at an extreme cost to the vendor, customer, and freight companies.</p>
<p>If real-time seems intimidating, I would encourage you to take a look at my Kaazing <a href="http://blog.kevinhoyt.com/2015/01/23/building-a-chat-application/">chat tutorial</a>.</p>

        
      </article>

    </main>

          

  <section id="contact">

  <h2>Let's Build Something Together</h2>

  <p>
    Have a project, collaboration, or opportunity you would like to discuss?
    I am especially interested in work involving web architecture, data,
    IoT, and developer experience.
  </p>

  <form data-netlify="true" netlify-honeypot="bot-field">

    <!-- Honeypot -->
    <div class="field honeypot">
      <label for="pot">Do not fill this out if you are human</label>
      <input id="pot" name="pot" type="text">      
    </div>

    <div class="field">
      <label for="poc">Name</label>
      <input type="text" id="poc" name="name" required>
    </div>

    <div class="field">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" required>
    </div>

    <div class="field">
      <label for="reason">Subject</label>
      <select id="reason" name="reason">
        <option value="">Select an option</option>
        <option value="Feedback">Writing feedback</option>        
        <option value="Project Collaboration">Project collaboration</option>
        <option value="Consulting">Consulting</option>
        <option value="Speaking">Speaking / workshops</option>
        <option value="Career Opportunity">Career opportunity</option>
        <option value="Other">Something else</option>
      </select>
    </div>

    <div class="field">
      <label for="message">Message</label>
      <textarea id="message" name="message" rows="6" required></textarea>
    </div>

    <button aria-label="Send Message" type="button">Send Message</button>    

  </form>

  <p class="email">
    Prefer email? You can reach me at <a aria-label="Email kevin@ketnerlake.com" href="mailto:kevin@ketnerlake.com">kevin@ketnerlake.com</a>.
  </p>

</section>

  <footer id="footer">

  <p>
    Made with ❤️ by Kevin Hoyt &copy; 2025 · Published with <a aria-label="Eleventy" href="https://www.11ty.dev">Eleventy</a>
  </p>
  
</footer>


  <script src="/script/menu.js"></script>

</body>
</html>
