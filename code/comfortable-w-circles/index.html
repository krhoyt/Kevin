<!DOCTYPE html>
<html lang="en">
<head>
  
  <meta charset="UTF-8">    
  <meta name="viewport" content="width=device-width, initial-scale=1">  
  <meta name="description" content="Make circles with code.">  

  <title>Pie</title>

  <style>
    html {
      height: 100%;
    }

    body {
      align-items: center;
      display: flex;
      height: 100%;
      justify-content: center;
      margin: 0;
      padding: 0;
    }

    circle {
      fill: none;
      stroke: #00000040;
    }

    path.plot {
      stroke-linejoin: round;
      stroke-width: 2px;
    }

    path.spoke {
      stroke: #00000040;
    }

    text {
      fill: #161616;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 400;
      letter-spacing: 0.50px;
      line-height: 20px;
    }

    text.label {
      font-weight: 600;
    }

    text.value {
      dominant-baseline: middle;
    }
  </style>

</head>
<body>

  <!-- Chart -->
  <!-- Reference: https://chartexpo.com/blog/polar-graph-equations -->
  <svg height="500" viewBox="-150 -150 300 300" width="500">
    <g></g>
  </svg>

  <script src="utility.js"></script>
  <script>
    const COLORS = ['#1f78b4', '#46a040'];
    const LABELS = [
      'Power tools', 
      'Electrical supplies', 
      'Plumbing items', 
      'Garden tools', 
      'Plants'
    ];
    const LEVELS = 5;    
    const RADIUS = 150;
    const SVGNS = 'http://www.w3.org/2000/svg';    

    const data = [
      [900, 900, 500, 900, 900],
      [600, 600, 650, 500, 600]
    ];
    const steps = RADIUS / LEVELS;

    // Find maximum value
    let maximum = 0;
    for( let d = 0; d < data.length; d++ ) {
      for( let v = 0; v < data[d].length; v++ ) {
        maximum = data[d][v] > maximum ? data[d][v] : maximum;
      }
    }

    // SVG element
    const svg = document.querySelector( 'svg' );
    const chart = document.querySelector( 'g' );

    // Circles
    for( let c = 0; c < LEVELS + 1; c++ ) {
      const circle = document.createElementNS( SVGNS, 'circle' );
      circle.setAttributeNS( null, 'r', steps * c );
      chart.appendChild( circle );
    }

    // Spokes
    for( let s = 0; s < LABELS.length; s++ ) {
      const angle = degreesToRadians( ( ( 360 / LABELS.length ) * s ) - 90 );
      const x = RADIUS * Math.cos( angle );
      const y = RADIUS * Math.sin( angle );

      const path = document.createElementNS( SVGNS, 'path' );
      path.classList.add( 'spoke' );
      path.setAttributeNS( null, 'd', `M 0 0 L ${x} ${y}` );
      chart.appendChild( path );
    }

    // Data 
    for( let d = 0; d < data.length; d++ ) {
      let plot = '';

      for( let v = 0; v < data[d].length; v++ ) {
        const angle = degreesToRadians( ( ( 360 / LABELS.length ) * v ) - 90 );
        const radius = map( data[d][v], 0, maximum, 0, RADIUS );
        const x = radius * Math.cos( angle );
        const y = radius * Math.sin( angle );

        if( v === 0 ) {
          plot = `M ${x} ${y} `;
        } else {
          plot = plot + `L ${x} ${y} `;
        }
      }

      plot = plot + 'Z';

      const path = document.createElementNS( SVGNS, 'path' );
      path.classList.add( 'plot' );
      path.setAttributeNS( null, 'stroke', COLORS[d] );
      path.setAttributeNS( null, 'fill', COLORS[d] + '40' );      
      path.setAttributeNS( null, 'd', plot );
      chart.appendChild( path );
    }

    // Values
    for( let v = 0; v < ( LEVELS + 1 ); v++ ) {
      const value = ( maximum / LEVELS ) * v;
      const y = 0 - ( ( RADIUS / LEVELS ) * v );

      const text = document.createElementNS( SVGNS, 'text' );
      text.classList.add( 'value' );
      text.textContent = `$${value}`;
      text.setAttributeNS( null, 'x', 4 );
      text.setAttributeNS( null, 'y', y );
      chart.appendChild( text );
    }

    // Labels
    for( let v = 0; v < LABELS.length; v++ ) {
      const angle = degreesToRadians( ( ( 360 / LABELS.length ) * v ) - 90 );
      const radius = v === 0 ? RADIUS + 16 : RADIUS + 8;
      const x = radius * Math.cos( angle );
      const y = radius * Math.sin( angle );

      const align = placement( v, LABELS.length );

      const text = document.createElementNS( SVGNS, 'text' );
      text.classList.add( 'label' );      
      text.textContent = LABELS[v];
      text.setAttributeNS( null, 'dominant-baseline', align.baseline );
      text.setAttributeNS( null, 'text-anchor', align.anchor );            
      text.setAttributeNS( null, 'x', x );
      text.setAttributeNS( null, 'y', y );
      chart.appendChild( text );      
    }

    const bounds = chart.getBBox();
    svg.setAttribute( 
      'viewBox', 
      `${bounds.x} ${bounds.y} ${bounds.width} ${bounds.height}` 
    );
    
    // NOTE: You can trim down the SVG element height if needed
    // svg.setAttribute( 'height', Math.ceil( bounds.height ) );

    // NOTE: Use Element.getBoundingClientRect() to account to transforms
    // const bounds = chart.getBoundingClientRect();    
    // chart.style.scale = 300 / Math.ceil( bounds.width );
  </script>

</body>
</html> 
